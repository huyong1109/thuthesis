\chapter{总结与展望}
\label{cha:conclusion}

\section{总结}
\label{sec:conclude}


本文主要研究气候模式中的可扩展性问题，并以应用广泛的全耦合气候模拟程序--公共地球系统模式CESM作为优化目标。
已有的很多研究都表明CESM的海洋模式分量并行海洋模式（POP）在众多分量模式中计算开销最大，可扩展性也较差。 
这是由于POP描述的海洋运动过程在时间和空间上的尺度相对于大气和陆面上的运动要大很多。  


本文通过复杂度分析和模拟测试数据发现，海洋模式POP中原有的基于共轭梯度法和改进后的ChronGear方法的正压求解器在大核数上的不良表现，
并且导致高分辨的POP的可扩展性很差。
目前已经有很多的工作在研究如何提高海洋模式POP中正压模态的性能，但是他们的大部分都没有从根本上解决POP正压模态中的可扩展性瓶颈。 
共轭梯度法是求解海洋模式正压模态的常见方法，但是通过对海洋模式POP正压模态的计算复杂度评估可以看出，共轭梯度法及其变形的迭代过程中因为计算內积而引入的全局通行是POP正压模态的可扩展性的瓶颈。 
基于这个结论，本文提出了基于CSI方法的新的求解器。
CSI方法没有耗时的全局通信操作，因此解决了原有正压求解器中的全局通信瓶颈。 
但是CSI方法的性能取决于对系数矩阵的最大最小特征值的估计。
为了能够高效和准确的地对系数矩阵两个极端的特征值进行估计， 本文提出了基于Lanczos方法的并行预估方法。
收敛速度的理论分析表明，CSI方法和原始的共轭梯度法有相同量级的收敛速度上限。
尽管真实应用中共轭梯度法通常比CSI方法收敛快一些，
但是从算法复杂度的分析可以看出，CSI求解器由于没有可扩展性差的全局通信操作，在大规模并行是应该会比CG求解器的速度快。
本文将CSI方法实现在海洋模式POP中并进行测试，并且发现CSI方法比原始的共轭梯度法有更好的可扩展性。
CSI方法使得正压模态在15,000核的执行时间从原来的41.96秒 下降到6.67秒。    
 
尽管新的CSI求解器相比于原始的CG求解器有了很大性能提升，海洋模式POP中斜压模态计算量巨大与正压模态通信复杂之间的矛盾仍然存在。
预处理方法是进一步提高求解器的有效方法。
本文针对海洋模式的并行特点，提出了基于误差向量传播方法的并行块预处理方法。
误差向量传播方法是求解椭圆方程十分高效的直接方法。
虽然它在求解大规模问题时有数值不稳定性，
但是结合并行块预处理的思想正好可以用来对并行环境中的正压求解器进行预处理。
基于误差向量传播方法的并行块预处理方法在块内求得块矩阵的逆，达到局部最佳的预处理效果，而在跨进程的块之间几乎不进行通信。
这种方式避免了加剧正压模态中的通信瓶颈，同时加速正压求解器的收敛速度，从而很好解决大计算量与通信瓶颈之间的矛盾。
新的预处理技术不仅能够应用在P-CSI方法中，对于原始的ChronGear方法也有类似的加速效果。
最终的P-CSI方法结合EVP并行块预处理在海洋模式中相对于原始的求解器取得了很好的加速效果。
在真实的模拟测试中，采用EVP块预处理的P-CSI方法的求解器相对于原始的求解器有了高达5倍的性能提升。
新的求解器将会有助于未来的低分辨率和高分辨率公共地球系统模式的模拟， 尤其是过去被海洋模式POP分量影响到可扩展性的全耦合模式。 


由于CESM-POP海洋模式被广泛的使用，在将本文所提出的新的求解器和预处理方法加入到气候模式之前，还必须验证这些方法不会再模拟结果中带来气候学上显著的误差。 
但是，由于海洋动力过程本身的不确定性，模拟结果常常由于处理器核数的改变等微小的因素而导致最后的模拟结果并不能做到完全一致。
这使得对气候模式模拟结果的检测十分困难。
当前海洋模式POP中提供的基于均方根误差的检测方法虽然能够简单的评估POP在新的机器上的运行结果的正确性，
但是它并不能检测和评估求解器引入的误差。
本文在大气模式中的基于集合模拟的一致性检测工具的启发下，在POP中实现了一个一个新的针对海洋模式的基于集合模拟的结果的一致性检测工具POP-ECT。
这个工具中使用的数据集合就是通过在模拟的初始场中加入随机扰动后得到的。
本文通过一些列参照实验，确定了集合模拟过程中几个决定性因素，比如模拟时间长度，集合的个数，评判的标准等。
利用这些参数得到的检测工具，不仅证明了本文所提出的新的求解器不会影响海洋模式的模拟结果，同时也清楚的反应出海洋模拟结果中由于改变并行度、改变误差参数化方案等引入的误差的级别。 
POP-ECT极大地提升了CESM-ECT工具集在确保CESM模拟正确性的能力。


 
\section{未来工作展望}
\label{sec:futurework}

本文的主要贡献是提出了一个针对高分辨海洋模式的正压求解器，并专门为海洋模式在大规模并行环境下的运行设计了一个高效的预处理技术。
本文第\ref{solver:exp:ideal}节的实验部分证明了本文所提出的高可扩展的海洋模式是通用的。
目前已经有相关计划将本文提出的求解器实现在其它海洋模式中，比如台湾的海洋模式TIMCOM\cite{tseng2011parallel}。 
本文所提出的基于误差向量传播方法的预处理方法，是针对高分辨率海洋模式在大规模并行环境下运行而设计的。
它的特点是利用这种情况下进程所管辖的块之间的独立性。 为了进一步改进预处理效果，我们设想下一步能将基于误差向量传播方法的预处理和多重网格相结合。 
多重网格方法天然的考虑整体的性质，因此，结合误差向量传播和多重网格能够实现兼顾局部最优和考虑整体。


针对求解器和预处理技术所带来的改动，本文还设计了相应的正确性验证工具。
目前，此工具已经被应用于某些实际问题中，比如海洋模式不同版本之间的校准。
未来，我们希望将它发展成为更为通用的验证工具。 
我们计划将这个工作在以下几个方面进行扩展。 
首先，本文提出的一致性检测方法可以在区域海洋上进行。
比如说，当一个模拟结果没有通过整体测试时，这个测试工具可以分区域进行测试，从而找出测试不能通过的具体区域。 
这种从粗粒度到细粒度的诊断使得我们能够找到造成错误或者误差的根源。 
其次，我们打算向Allison等人在大气模式CAM的压缩数据中做得工作一样\cite{baker2014methodology}一样，利用这个工具去评估一下数据压缩在海洋模式中的影响。
这种评估压缩过程中数据精度丢失是否会造成最终的结果在统计学上不一致的能力，对于压缩方法能否被接受为减少海洋模拟数据的数据量来说至关重要。 



