\chapter{绪论}
\label{cha:intro}

\section{地球气候系统模式概述}
\subsection{地球气候系统}
\subsection{地球气候系统模式}


近年来，高分辨率全球气候模式已经成为了理解气候现象和预测未来气候变化的一个不可或缺的手段。地球系统
目前，以美国国家大气研究中心（the National Center for Atmospheric Research， NCAR) 主导开发的
公共地球系统模式（the Community Earth System Model， CESM) 是应用最为广泛的全球气候模式之一。
在政府间气候变化专门委员会（the
Intergovernmental Panel on Climate Change， IPCC) 第五次评估报告（the Fifth Assessment
Report， AR5)中，直接或间接使用公共地球系统模式的预测结果占了相当大的比例 \cite{stocker2013ipcc}。
 

公共地球系统模式是一个全耦合的气候系统模式，它包括了大气、海洋、海冰和路面等分量模式。
其中，海洋模式需要模拟的气候现象的时间尺度和空间尺度跨度都很大。 
海洋细粒度涡旋的空间尺度只有$\mathcal{O}$(10 - 100 km)， 比与之在动力学角度上相对应的大气中的天气系统的尺度要小一到两个量级。
同时，深海环流的时间尺度长达数个世纪甚至几千年，比大气中相对应的时间尺度要长几个量级。
对更高分辨率和更长模拟时间的要求，使得全球涡分辨的海洋气候模式的计算开销要比大气模式的开销大出很多\cite{bryan2010frontal,mcclean2011prototype,graham2014importance}。


更为重要的是，气候模式通常需要模拟几十年甚至数百年。如此长期的模拟需求使得气候模式在采用高分辨率时的计算开销在目前的计算资源下完全无法承受。比如，在政府间气候变化专门委员会第五次评估报告中，大部分的公共地球系统模式的模拟都是采用的近似1度的海洋模式，组合以1度到2度的大气模式。
近几年超级计算机资源的增长以及高分辨卫星观测数据的出现促进了很多科研工作者研究如何通过提高高分辨率气候模式的并行计算效率，进而减少高分辨率模式的计算开销。


公共地球系统模式中的海洋分量模式，并行海洋模式POP（the Parallel Ocean Model) 求解的是采用静力平衡近似和布辛奈斯克（Boussinesq）近似的三维原始方程组。 
它将时间积分分成两个部分：斜压模态和正压模态。 
斜压模态描述的是三维的动力学和热动力学过程，而正压模态是求解二维的垂直积分后的动量方程和连续性方程。
隐士自由面方法在求解海洋模式正压模态中是一个很常见的选择，因为它能够允许较大的时间步长来高效的计算速度很快（约200m/s)的重力波。
然而，使用这个方法时需要求解大规模椭圆方程组，而这个方程的求解过程在并行海洋模式中可扩展性很差。
事实上，已有研究表明，并行海洋模式的正压求解的比较差的可扩展性主要是由于通信的开销导致的\cite{Worley:2011:PCE:2063384.2063457}。 
如果能优化并行海洋模式的正压求解，将会使得整个公共地球系统模式的性能有较大的提升\cite{dennis2012computational}。 

近几年高分辨率全球气候模式的发展表明，提高模式的分辨有助于更好的模拟重要气候过程，进而改善气候预测的结果。
提高分辨率可以极大的改善赤道不稳定波\citep{roberts2009impact}、厄尔尼诺南方涛动(ENSO) \citep{shaffrey2009uk}、墨西哥湾流\citep{chassignet2008gulf, kuwano2010precipitation} 、全球水循环\citep{demory2014role}等气候现象。
此外，\cite{gent2010improvements} 和 \cite{wehner2014effect}的研究表明提高大气模式的分辨率可以模拟出更好的气候平均态、更准确的赤道风暴的形成过程，和更加真实的极端降水量。
 \cite{bryan2010frontal} 和 \cite{graham2014importance}的研究也证明，将海洋模式的分辨率提高到涡解析度水平能够捕捉到海表高度和海表风应力之间的正相关性，同时也可以改善厄尔尼诺南方涛动周期模拟中的不对称性。


在第六次国际耦合模式比较计划（CMIP6） 中的高分辨率模式比较计划（HighResMIP）中，有采用中纬度25公里分辨率甚至更高的全球模式申请实现Tier-1和Tier-2实验。 
由于所有参与CMIP6的气候模式通常需要运行数百年，这些高分辨率的模式需要使用巨大的计算资源， 以至于这些模拟的计算消耗及其之大。
为了能够更加常规化的运行这些高分辨的气候模式，需要我们进一步的进行算法优化，来充分的利用大规模的计算资源。

 
我们的工作主要集中在提高由美国国家大气研究中心带头发展的地球系统模式CESM中的海洋模式分量POP的模拟速度。 CESM是一个全耦合的气候系统模式，它包括大气模式、海洋模式、海冰模式、和陆面模式等。


\section{海洋模式正压模态}
\subsection{正压求解器}
正压求解器是高分辨率CESM版本中POP的主要性能瓶颈，因为当在大核数上运行时它的运行时间占了POP总运行时间的一大半。 
这是由于求解自由海表面的正压求解器中算法所固有的明显的全局通信操作在大核数下的可扩展性比较差所导致的。
共轭梯度法（CG）以及它的变换形式是比较常用的求解海洋模式中因隐式计算自由海表面而得到的椭圆方程组的方法。
比较著名的海洋模式如MITgcm\citep{adcroft2014mitgcm}， FVCOM\citep{lai2010nonhydrostatic}， MOM3\citep{pacanowsky1999mom3}， OPA \citep{madec1997ocean}
都采用了共轭梯度法或其变种来求解自由海表面方程。
然而，共轭梯度法在当前的海洋模式分量POP中造成了比较严重的通信瓶颈\citep{Worley:2011:PCE:2063384.2063457}。 
很多研究工作都尝试去提高共轭梯度法的性能，他们中的大多数要么是减少处理器间的通信次数，要么是加快每个处理器上的计算速度。
其中最为著名的工作是，修正标准的共轭梯度法，从而减少全局通信的次数。 比如POP中采用的Chronopoulos-Gear (ChronGear, \cite{dAzevedo1999lapack})就是共轭梯度法的一个变种。
这些方法和最近的一些变形(比如\cite{hoemmen2010})都是尝试去减少全局通信，但是要么效果不太明显，要么变形后的算法很难与复杂一点的预处理子相结合\citep{ghysels2014}。
另外，还有一些研究是通过将全局通信与矩阵向量乘法利用流水线的方式来重叠，进而提高共轭梯度法的并行效率。关于如何减少共轭梯度法中全局通信的开销，文章\cite{ghysels2014}给出了一个非常详尽的总结。

目前公共地球系统模式中并行海洋模式推荐的线性正压模态求解器是采用对角预处理的Chronopoulos-Gear (ChronGear) 方法
\cite{dAzevedo1999lapack}。 这是一种修正后的预处理共轭梯度法（Preconditioned Conjugate
Gradient method，PCG)。 
ChronGear继承了预处理共轭梯度法的缺陷--迭代过程中需要全局求和，从而使得它不能很好地扩展，并成为了高分辨模拟中的一个性能瓶颈。
为了提高并行海洋模式，同时也是公共地球系统模式的可扩展性，我们通过消除求解器迭代过程中的全局求和操作以及发展一个更高效的预处理子来提高正压求解器的并行计算效率。
我们的主要贡献如下： 
\subsection{正压求解器的瓶颈}

\section{气候模式的不确定性}

\section{本文主要研究内容和主要贡献}
\subsection{主要研究内容}
\subsection{主要贡献}
\begin{itemize}
\item  
我们发展了一个新的基于误差向量传播方法的并行块预处理子\cite{roache1995elliptic}，来提高并行海洋模式正压求解器的收敛。 
\item  
我们为传统Stiefel迭代算法（CSI）\cite{hu2013scalable}增加了一个预处理接口，最终在公共地球系统模式1.2.0版本中实现了一个采用了新的基于误差向量传播方法的并行块预处理子的CSI求解器（P-CSI）。
\item  
我们证明了使用块误差向量传播方法作为预处理子能够提高ChronGear方法和P-CSI方法的收敛性。 
\item  
我们在高分辨率POP的正压模态求解中取得了5.2倍的加速。采用块EVP预处理的P-CSI求解器相比于原始求解器有很好的可扩展性，从而极大的提高了海洋模式POP乃至CESM在大核数下的可扩展性。 
\item  
我们在POP中提出并实现了一个基于集合模拟的统计方法，来评估线性求解器引入的误差对整个模式结果的影响。最终确证了采用我们的新的求解器得到结果与原始结果在统计意义上是一致的。 
\end{itemize}
\subsection{主要组织结构}
本文其他章节结构如下：


