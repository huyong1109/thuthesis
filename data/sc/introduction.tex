\section{Introduction} \label{se:int}
% no \IEEEPARstart
High-resolution global climate models have become increasingly important
in recent years as a means for understanding climate variability
and projecting future climate change.  The Community Earth System
Model (CESM), whose development is centered at the National Center for
Atmospheric Research (NCAR), is one of the most widely used global
climate models, and its climate projections are a key component in the
Intergovernmental Panel on Climate Change (IPCC) Fifth Assessment
Report (AR5) \cite{stocker2013ipcc}.

% CESM is a fully-coupled climate model system, including atmosphere,
% ocean, sea-ice and land components. \hl{In particular, the ocean component
% requires the modeling of broad spatial and temporal scales in order to
% encompass the relevant dynamics where the ocean energy dominates.  The
% spatial scales range from tens of meters of the sub-mesoscale eddies
% to dimensions of the ocean basins, and the temporal scales range from
% the order of days for gravity waves to centuries for slow planetary
% waves.}  As a result, ocean models have to iterate for a longer time at
% a finer resolution, which makes them computationally intensive
% \cite{Worley:2011:PCE:2063384.2063457,dennis2012computational}.
% However, many recent studies demonstrate that high-resolution ocean
% models are required in order to produce more realistic and accurate
% predictions
% \cite{bryan2010frontal,mcclean2011prototype,graham2014importance}.

CESM is a fully-coupled climate system model, including atmosphere,
ocean, sea-ice and land components. In particular, the ocean component
is required to represent processes across a broad range of spatial and
temporal scales relevant to climate science. Ocean mesoscale eddies
have spatial scales of $\mathcal{O}$(10 - 100 km), one to two orders of magnitude
smaller than the dynamically analogous weather systems in the
atmosphere. The adjustment time scale for the deep ocean is many
centuries up to a few millennia, again orders of magnitude longer than
the corresponding timescales in the atmosphere. The computational
burden of a global eddy-resolving ocean climate model \cite{bryan2010frontal,mcclean2011prototype,graham2014importance} is
thus increased over that for an atmosphere model by the demand for
finer spatial resolution and longer integration times.

Moreover, climate model simulations are often run for decades or
even centuries, but these long-term simulations are typically too
computationally expensive to run at high-resolution.  For example,
most CESM simulations in IPCC AR5 are carried out with a nominal
1\degree\space ocean and a 1\degree\space to 2\degree\space atmosphere model.
Recent increases in both supercomputing resources and
high-resolution satellite observations have motivated
efforts to improve the parallel performance of high-resolution climate
models so that they can be run more routinely (and for less cost).

%Recently, the increasing computational power of supercomputers and
%high-resolution satellite observations have inspired much research
%that focuses on adapting high-resolution climate models for massive
%parallelism.
%As noted, in most production simulations, the least scalable
%component of CESM is the ocean model Parallel Ocean Model (POP)
%\cite{dennis2012computational}.

The Parallel Ocean Model (POP) component of CESM solves the
three-dimensional primitive equations with hydrostatic and Boussinesq
approximations \cite{smith2010parallel} and divides the time
integration into two parts: the baroclinic and the
barotropic modes. The baroclinic mode describes the 
three-dimensional dynamic and thermodynamics processes, and the barotropic
mode solves the vertically-integrated momentum and continuity
equations in two dimensions. The implicit free-surface method is a common choice
in barotropic mode in ocean models because it allows a large time step to
efficiently compute the fast gravity mode.  However, this method
requires solving a large elliptic system of equations, which
scales poorly in POP.  In fact, the poor scaling performance of the
barotropic solver in POP, which is dominated by the communication
overhead \cite{Worley:2011:PCE:2063384.2063457}, is well known, and
its optimization will benefit the entire CESM model
\cite{dennis2012computational}.

The currently recommended linear solver for the barotropic mode in CESM
POP is the Chronopoulos-Gear (ChronGear) method
\cite{dAzevedo1999lapack}, a modified Preconditioned Conjugate
Gradient method (PCG), combined with a diagonal preconditioner.
The required global reduction in the ChronGear method does not scale well and
causes a bottleneck for high-resolution simulations.  To improve the scaling
of POP, and, therefore CESM, we focus on optimizing the barotropic
solver by eliminating global reductions and developing a more
effective preconditioner.  In particular, we make the following
contributions:


%MOVE TO RELATED WORK
%There are currently different alternatives to mitigate the poor behavior of the PCG type of solver in the massive parallelization.
%Some approaches attempt to overlap the communication with computation time\cite{beare1997optimisation}.
%Some use the land elimination and load-balance strategies \cite{dennis2007inverse, dennis2008scaling}
%to reduce the number of processes and the associated overhead of global reduction.
%Although these approaches may improve performance, they do not eliminate the major bottleneck of the global reduction.


\begin{itemize}
\item We develop a new block parallel preconditioner based on the
Error Vector Propagation (EVP) method \cite{roache1995elliptic} designed to
improve solver convergence in the POP barotropic mode.
\item We add a preconditioning interface to the Classical Stiefel Iteration
(CSI) solver explored in \cite{hu2013scalable} and
implement the resulting preconditioned CSI (P-CSI) solver
and new EVP block preconditioner in CESM1.2.0 POP.
\item We demonstrate an improvement in convergence rate for both ChronGear and
P-CSI when using block EVP.
\item We obtain a 5.2x speedup of
  the barotropic mode in high-resolution POP due to the improved scalability
of P-CSI with block EVP preconditioning, greatly improving the
scalability of POP (and ultimately CESM) at large core counts.
\item We develop and apply an ensemble-based statistical method to evaluate the impact
of changing the linear solver in POP and ensure that a consistent ocean climate is produced.
\end{itemize}

The remainder of this paper is organized as follows.
Section \ref{se:baro} discusses POP's barotropic solver and its scalability.
Sections \ref{se:psi} and \ref{se:evp} detail the design
of P-CSI for POP and the development of the block EVP preconditioner.
Section \ref{se:exp} compares the scalability of the ChronGear and
P-CSI solvers.  Section \ref{se:ver} verifies the new P-CSI solver
using the ensemble based statistical method.
Finally,  related work and conclusions are presented in Sections
\ref{se:rel} and \ref{se:conc}, respectively.

%{\textbf better to move related work in the next section.}

% You must have at least 2 lines in the paragraph with the drop letter
% (should never be an issue)
